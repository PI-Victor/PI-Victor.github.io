<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>Make your life with gRPC easier :: Software and Ops</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Earlier this year i started to write a lot of gRPC services and after a while fiddling around, there are things that are worth mentioning for the uninitiated.
Design documentation I found the Google API design documentation useful for making you adopt some standards for your APIs early on. You don&amp;rsquo;t have to follow it word by word, but overall it definitely has its use. From mapping http methods to gRPC methods to naming conventions that help you design your API intuitive for future growth." />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />

<link rel="canonical" href="https://victor.cloudflavor.io/2020/12/make-your-life-with-grpc-easier/" />






  
  
  
  
  
  <link rel="stylesheet" href="https://victor.cloudflavor.io/styles.css">







  <link rel="shortcut icon" href="https://victor.cloudflavor.io/img/theme-colors/orange.png">
  <link rel="apple-touch-icon" href="https://victor.cloudflavor.io/img/theme-colors/orange.png">



<meta name="twitter:card" content="summary" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Make your life with gRPC easier">
<meta property="og:description" content="Earlier this year i started to write a lot of gRPC services and after a while fiddling around, there are things that are worth mentioning for the uninitiated.
Design documentation I found the Google API design documentation useful for making you adopt some standards for your APIs early on. You don&amp;rsquo;t have to follow it word by word, but overall it definitely has its use. From mapping http methods to gRPC methods to naming conventions that help you design your API intuitive for future growth." />
<meta property="og:url" content="https://victor.cloudflavor.io/2020/12/make-your-life-with-grpc-easier/" />
<meta property="og:site_name" content="Software and Ops" />

  
    <meta property="og:image" content="img/favicon/%!s().png">
  

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">


  <meta property="article:published_time" content="2020-12-13 05:02:27 &#43;0100 CET" />












</head>
<body class="">


<div class="container center headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="https://victor.cloudflavor.io/">
  <div class="logo">
    Cloudflavor
  </div>
</a>

    </div>
    
      <ul class="menu menu--mobile">
  <li class="menu__trigger">Menu&nbsp;â–¾</li>
  <li>
    <ul class="menu__dropdown">
      
        
          <li><a href="/about">about</a></li>
        
      
        
          <li><a href="/posts">blog</a></li>
        
      
        
          <li><a href="https://github.com/pi-victor">github</a></li>
        
      
      
    </ul>
  </li>
</ul>

    
    
  </div>
  
    <nav class="navigation-menu">
  <ul class="navigation-menu__inner menu--desktop">
    
      
        
          <li><a href="/about">about</a></li>
        
      
        
          <li><a href="/posts">blog</a></li>
        
      
        
          <li><a href="https://github.com/pi-victor">github</a></li>
        
      
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<article class="post">
  <h1 class="post-title">
    <a href="https://victor.cloudflavor.io/2020/12/make-your-life-with-grpc-easier/">Make your life with gRPC easier</a>
  </h1>
  <div class="post-meta">
    
      <time class="post-date">
        2020-12-13 ::
        
      </time>
    
    
      <span class="post-author">PI-Victor</span>
    
    
  </div>

  
    <span class="post-tags">
      
      #<a href="https://victor.cloudflavor.io/tags/grpc/">grpc</a>&nbsp;
      
      #<a href="https://victor.cloudflavor.io/tags/go/">go</a>&nbsp;
      
      #<a href="https://victor.cloudflavor.io/tags/protobuf/">protobuf</a>&nbsp;
      
      #<a href="https://victor.cloudflavor.io/tags/reflection/">reflection</a>&nbsp;
      
      #<a href="https://victor.cloudflavor.io/tags/grpcurl/">grpcurl</a>&nbsp;
      
      #<a href="https://victor.cloudflavor.io/tags/debugging/">debugging</a>&nbsp;
      
      #<a href="https://victor.cloudflavor.io/tags/tips/">tips</a>&nbsp;
      
    </span>
  
  


  

  <div class="post-content"><div>
        <p>Earlier this year i started to write a lot of gRPC services and after a while fiddling around, there
are things that are worth mentioning for the uninitiated.</p>
<h3 id="design-documentation">Design documentation<a href="#design-documentation" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>I found the <a href="https://cloud.google.com/apis/design">Google API design documentation</a> useful for making you
adopt some standards for your APIs early on. You don&rsquo;t have to follow it word by word, but overall it
definitely has its use. From <a href="https://cloud.google.com/apis/design/standard_methods">mapping http methods to gRPC methods</a>
to <a href="https://cloud.google.com/apis/design/naming_convention">naming conventions</a> that help you design your
API intuitive for future growth.</p>
<h3 id="exploring-grpc-apis-at-runtime">Exploring gRPC APIs at runtime<a href="#exploring-grpc-apis-at-runtime" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>You can explore gRPC APIs at runtime by using <a href="https://github.com/fullstorydev/grpcurl">grpcurl</a>.
grpcurl is not only able to behave like regular curl but it can also be used to explore your API, this can
be achieved in two ways:</p>
<ul>
<li>enable reflection in your code</li>
<li>passing the protoset source file as a parameter</li>
<li>passing the protoset compiled bin file</li>
</ul>
<h4 id="enabling-and-exploring-with-reflection">Enabling and exploring with reflection<a href="#enabling-and-exploring-with-reflection" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>Given the following protobuf API:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-0"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-0">0</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-1">1</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-2">2</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-3"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-3">3</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-4"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-4">4</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-5"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-5">5</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-6"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-6">6</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-proto" data-lang="proto"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">service</span> StorageApiService {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">rpc</span> GetBuckets(GetBucketsRequest) <span style="color:#ff79c6">returns</span> (GetBucketsResponse) {}
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">message</span> <span style="color:#50fa7b">GetBucketRequest</span> {}
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">message</span> <span style="color:#50fa7b">GetBucketsResponse</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">repeated</span> Bucket buckets <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>Import reflection and register the gRPC server instance.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="0"><a style="outline:none;text-decoration:none;color:inherit" href="#0"> 0</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="1"><a style="outline:none;text-decoration:none;color:inherit" href="#1"> 1</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="2"><a style="outline:none;text-decoration:none;color:inherit" href="#2"> 2</a>
</span><span style="background-color:#3d3f4a"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="3"><a style="outline:none;text-decoration:none;color:inherit" href="#3"> 3</a>
</span></span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="4"><a style="outline:none;text-decoration:none;color:inherit" href="#4"> 4</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="5"><a style="outline:none;text-decoration:none;color:inherit" href="#5"> 5</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="6"><a style="outline:none;text-decoration:none;color:inherit" href="#6"> 6</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="7"><a style="outline:none;text-decoration:none;color:inherit" href="#7"> 7</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="8"><a style="outline:none;text-decoration:none;color:inherit" href="#8"> 8</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="9"><a style="outline:none;text-decoration:none;color:inherit" href="#9"> 9</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="10"><a style="outline:none;text-decoration:none;color:inherit" href="#10">10</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="11"><a style="outline:none;text-decoration:none;color:inherit" href="#11">11</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="12"><a style="outline:none;text-decoration:none;color:inherit" href="#12">12</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="13"><a style="outline:none;text-decoration:none;color:inherit" href="#13">13</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="14"><a style="outline:none;text-decoration:none;color:inherit" href="#14">14</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="15"><a style="outline:none;text-decoration:none;color:inherit" href="#15">15</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="16"><a style="outline:none;text-decoration:none;color:inherit" href="#16">16</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="17"><a style="outline:none;text-decoration:none;color:inherit" href="#17">17</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="18"><a style="outline:none;text-decoration:none;color:inherit" href="#18">18</a>
</span><span style="background-color:#3d3f4a"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="19"><a style="outline:none;text-decoration:none;color:inherit" href="#19">19</a>
</span></span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="20"><a style="outline:none;text-decoration:none;color:inherit" href="#20">20</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="21"><a style="outline:none;text-decoration:none;color:inherit" href="#21">21</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="22"><a style="outline:none;text-decoration:none;color:inherit" href="#22">22</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff79c6">import</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;net&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex; background-color:#3d3f4a"><span>    <span style="color:#f1fa8c">&#34;google.golang.org/grpc/reflection&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;google.golang.org/grpc&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">...</span>
</span></span><span style="display:flex;"><span>    lis, err <span style="color:#ff79c6">:=</span> net.<span style="color:#50fa7b">Listen</span>(<span style="color:#f1fa8c">&#34;tcp&#34;</span>, <span style="color:#f1fa8c">&#34;0.0.0.0:8099&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">panic</span>(err)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">defer</span> lis.<span style="color:#50fa7b">Close</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">var</span> opts []grpc.ServerOption
</span></span><span style="display:flex;"><span>    grpcServer <span style="color:#ff79c6">:=</span> grpc.<span style="color:#50fa7b">NewServer</span>(opts<span style="color:#ff79c6">...</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// register your gRPC implementation first
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    pbv1.<span style="color:#50fa7b">RegisterStorageApiService</span>(grpcServer, <span style="color:#50fa7b">newServer</span>())
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// enable reflection 
</span></span></span><span style="display:flex; background-color:#3d3f4a"><span><span style="color:#6272a4"></span>    reflection.<span style="color:#50fa7b">Register</span>(grpcServer)
</span></span><span style="display:flex;"><span>    grpcServer.<span style="color:#50fa7b">Serve</span>(list)
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">...</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></td></tr></table>
</div>
</div>
<p>Assuming that the server is running on <code>tcp://localhost:8099</code>,
you can now explore the API by using <code>list</code> and <code>describe</code>.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-0"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-0"> 0</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-1"> 1</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-2"> 2</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-3"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-3"> 3</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-4"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-4"> 4</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-5"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-5"> 5</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-6"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-6"> 6</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-7"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-7"> 7</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-8"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-8"> 8</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-9"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-9"> 9</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-10"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-10">10</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-11"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-11">11</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-12"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-12">12</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-13"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-13">13</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-14"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-14">14</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-15"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-15">15</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-16"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-16">16</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-17"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-17">17</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-18"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-18">18</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-19"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-19">19</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-20"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-20">20</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-21"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-21">21</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-22"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-22">22</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-23"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-23">23</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-24"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-24">24</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ grpcurl --plaintext localhost:8099 list
</span></span><span style="display:flex;"><span>codeflavor.grpcrest.proto.v1.StorageApiService
</span></span><span style="display:flex;"><span>grpc.reflection.v1alpha.ServerReflection
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ grpcurl --plaintext localhost:8099 describe codeflavor.grpcrest.proto.v1.StorageApiService
</span></span><span style="display:flex;"><span>codeflavor.grpcrest.proto.v1.StorageApiService is a service:
</span></span><span style="display:flex;"><span>service StorageApiService <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>  rpc GetBuckets <span style="color:#ff79c6">(</span> .codeflavor.grpcrest.proto.v1.GetBucketsRequest <span style="color:#ff79c6">)</span> returns <span style="color:#ff79c6">(</span> .codeflavor.grpcrest.proto.v1.GetBucketsResponse <span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{}</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ grpcurl --plaintext localhost:8099 describe codeflavor.grpcrest.proto.v1.StorageApiService.GetBuckets
</span></span><span style="display:flex;"><span>codeflavor.grpcrest.proto.v1.StorageApiService.GetBuckets is a method:
</span></span><span style="display:flex;"><span>rpc GetBuckets <span style="color:#ff79c6">(</span> .codeflavor.grpcrest.proto.v1.GetBucketsRequest <span style="color:#ff79c6">)</span> returns <span style="color:#ff79c6">(</span> .codeflavor.grpcrest.proto.v1.GetBucketsResponse <span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ grpcurl --plaintext localhost:8099 codeflavor.grpcrest.proto.v1.StorageApiService.GetBuckets
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;buckets&#34;</span>: <span style="color:#ff79c6">[</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;name&#34;</span>: <span style="color:#f1fa8c">&#34;bucket1&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;name&#34;</span>: <span style="color:#f1fa8c">&#34;bucket2&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">]</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="exploring-using-the-protoset-source-file">Exploring using the protoset source file<a href="#exploring-using-the-protoset-source-file" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>In certain situations you might not want to make the API publicly available, especially on the internet.
This type of information can become a security concern if it is made publicly available.</p>
<p>Without reflection enabled, we&rsquo;re unable to browse the API like we did above.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-0"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-0">0</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-1">1</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ grpcurl --plaintext localhost:8099 list
</span></span><span style="display:flex;"><span>Failed to list services: server does not support the reflection API
</span></span></code></pre></td></tr></table>
</div>
</div><p>However we can pass the protoset source file:</p>
<p><strong>NOTE</strong>: If you import special proto files, like i do below, the paths need to be passed to <code>grpcurl</code>. In
my example i use the <code>grpc-gateway</code> annotations file (which i&rsquo;ll write a post about soon, ignore the
<code>option</code> entry for now).</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-0"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-0"> 0</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-1"> 1</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-2"> 2</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-3"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-3"> 3</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-4"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-4"> 4</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-5"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-5"> 5</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-6"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-6"> 6</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-7"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-7"> 7</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-8"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-8"> 8</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-9"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-9"> 9</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-10"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-10">10</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-11"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-11">11</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-12"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-12">12</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-13"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-13">13</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-14"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-14">14</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-15"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-15">15</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-16"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-16">16</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-17"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-17">17</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-18"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-18">18</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-19"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-19">19</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-20"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-20">20</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-21"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-21">21</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>grpcurl --plaintext -import-path internal -import-path /usr/local/include/ -proto proto/grpcrest.proto localhost:8099 list
</span></span><span style="display:flex;"><span>codeflavor.grpcrest.proto.v1.StorageApiService
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>grpcurl --plaintext -import-path internal -import-path /usr/local/include -proto proto/grpcrest.proto localhost:8099 describe
</span></span><span style="display:flex;"><span>codeflavor.grpcrest.proto.v1.StorageApiService is a service:
</span></span><span style="display:flex;"><span>service StorageApiService <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>  rpc CreateBucket <span style="color:#ff79c6">(</span> .codeflavor.grpcrest.proto.v1.CreateBucketRequest <span style="color:#ff79c6">)</span> returns <span style="color:#ff79c6">(</span> .codeflavor.grpcrest.proto.v1.CreateBucketResponse <span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    option <span style="color:#ff79c6">(</span>.google.api.http<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">{</span> post:<span style="color:#f1fa8c">&#34;/v1/buckets&#34;</span> body:<span style="color:#f1fa8c">&#34;*&#34;</span> response_body:<span style="color:#f1fa8c">&#34;bucket&#34;</span>  <span style="color:#ff79c6">}</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>  rpc GetBuckets <span style="color:#ff79c6">(</span> .codeflavor.grpcrest.proto.v1.GetBucketsRequest <span style="color:#ff79c6">)</span> returns <span style="color:#ff79c6">(</span> .codeflavor.grpcrest.proto.v1.GetBucketsResponse <span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    option <span style="color:#ff79c6">(</span>.google.api.http<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">{</span> get:<span style="color:#f1fa8c">&#34;/v1/buckets&#34;</span>  <span style="color:#ff79c6">}</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>  rpc GetObject <span style="color:#ff79c6">(</span> .codeflavor.grpcrest.proto.v1.GetObjectRequest <span style="color:#ff79c6">)</span> returns <span style="color:#ff79c6">(</span> .codeflavor.grpcrest.proto.v1.GetObjectResponse <span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    option <span style="color:#ff79c6">(</span>.google.api.http<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">{</span> get:<span style="color:#f1fa8c">&#34;/v1/buckets/{bucket}/objects/*&#34;</span>  <span style="color:#ff79c6">}</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>  rpc GetObjects <span style="color:#ff79c6">(</span> .codeflavor.grpcrest.proto.v1.GetObjectsRequest <span style="color:#ff79c6">)</span> returns <span style="color:#ff79c6">(</span> .codeflavor.grpcrest.proto.v1.GetObjectsResponse <span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    option <span style="color:#ff79c6">(</span>.google.api.http<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">{</span> get:<span style="color:#f1fa8c">&#34;/v1/buckets/{bucket}/objects&#34;</span>  <span style="color:#ff79c6">}</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>  rpc GetResult <span style="color:#ff79c6">(</span> .codeflavor.grpcrest.proto.v1.GetResultRequest <span style="color:#ff79c6">)</span> returns <span style="color:#ff79c6">(</span> stream .codeflavor.grpcrest.proto.v1.GetResultResponse <span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    option <span style="color:#ff79c6">(</span>.google.api.http<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">{</span> get:<span style="color:#f1fa8c">&#34;/v1/results&#34;</span>  <span style="color:#ff79c6">}</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="exploring-using-the-compiled-protoset-bin-file">Exploring using the compiled protoset bin file<a href="#exploring-using-the-compiled-protoset-bin-file" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>Alternatively you can pass the compiled protoset binary file.</p>
<p>Compile the protoset bin file:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-4-0"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-4-0">0</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-4-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-4-1">1</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-4-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-4-2">2</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ protoc --proto_path<span style="color:#ff79c6">=</span>. <span style="color:#f1fa8c">\
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c"></span>    --descriptor_set_out<span style="color:#ff79c6">=</span>StorageApiService.protoset <span style="color:#f1fa8c">\
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c"></span>    --include_imports internal/proto/grpcrest.proto
</span></span></code></pre></td></tr></table>
</div>
</div><p>Use the protoset bin file to describe the API</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-0"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-0"> 0</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-1"> 1</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-2"> 2</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-3"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-3"> 3</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-4"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-4"> 4</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-5"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-5"> 5</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-6"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-6"> 6</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-7"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-7"> 7</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-8"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-8"> 8</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-9"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-9"> 9</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-10"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-10">10</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-11"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-11">11</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-12"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-12">12</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-13"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-13">13</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-14"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-14">14</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-15"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-15">15</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-16"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-16">16</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-17"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-17">17</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-18"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-18">18</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ grpcurl --plaintext  -protoset StorageApiService.protoset  localhost:8099 describe
</span></span><span style="display:flex;"><span>codeflavor.grpcrest.proto.v1.StorageApiService is a service:
</span></span><span style="display:flex;"><span>service StorageApiService <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>  rpc CreateBucket <span style="color:#ff79c6">(</span> .codeflavor.grpcrest.proto.v1.CreateBucketRequest <span style="color:#ff79c6">)</span> returns <span style="color:#ff79c6">(</span> .codeflavor.grpcrest.proto.v1.CreateBucketResponse <span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    option <span style="color:#ff79c6">(</span>.google.api.http<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">{</span> post:<span style="color:#f1fa8c">&#34;/v1/buckets&#34;</span> body:<span style="color:#f1fa8c">&#34;*&#34;</span> response_body:<span style="color:#f1fa8c">&#34;bucket&#34;</span>  <span style="color:#ff79c6">}</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>  rpc GetBuckets <span style="color:#ff79c6">(</span> .codeflavor.grpcrest.proto.v1.GetBucketsRequest <span style="color:#ff79c6">)</span> returns <span style="color:#ff79c6">(</span> .codeflavor.grpcrest.proto.v1.GetBucketsResponse <span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    option <span style="color:#ff79c6">(</span>.google.api.http<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">{</span> get:<span style="color:#f1fa8c">&#34;/v1/buckets&#34;</span>  <span style="color:#ff79c6">}</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>  rpc GetObject <span style="color:#ff79c6">(</span> .codeflavor.grpcrest.proto.v1.GetObjectRequest <span style="color:#ff79c6">)</span> returns <span style="color:#ff79c6">(</span> .codeflavor.grpcrest.proto.v1.GetObjectResponse <span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    option <span style="color:#ff79c6">(</span>.google.api.http<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">{</span> get:<span style="color:#f1fa8c">&#34;/v1/buckets/{bucket}/objects/*&#34;</span>  <span style="color:#ff79c6">}</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>  rpc GetObjects <span style="color:#ff79c6">(</span> .codeflavor.grpcrest.proto.v1.GetObjectsRequest <span style="color:#ff79c6">)</span> returns <span style="color:#ff79c6">(</span> .codeflavor.grpcrest.proto.v1.GetObjectsResponse <span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    option <span style="color:#ff79c6">(</span>.google.api.http<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">{</span> get:<span style="color:#f1fa8c">&#34;/v1/buckets/{bucket}/objects&#34;</span>  <span style="color:#ff79c6">}</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>  rpc GetResult <span style="color:#ff79c6">(</span> .codeflavor.grpcrest.proto.v1.GetResultRequest <span style="color:#ff79c6">)</span> returns <span style="color:#ff79c6">(</span> stream .codeflavor.grpcrest.proto.v1.GetResultResponse <span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    option <span style="color:#ff79c6">(</span>.google.api.http<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">{</span> get:<span style="color:#f1fa8c">&#34;/v1/results&#34;</span>  <span style="color:#ff79c6">}</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="debugging">Debugging<a href="#debugging" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>Exporting <code>GODEBUG=http2debug=2</code> locally, in the container or in the k8s pod where the gRPC server instance
is currently running is a godsend for troubleshooting problems with incoming requests and also checking if
your requests are actually hitting the server.</p>
<p>From the CLI, as mentioned above:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-0"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-0"> 0</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-1"> 1</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-2"> 2</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-3"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-3"> 3</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-4"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-4"> 4</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-5"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-5"> 5</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-6"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-6"> 6</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-7"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-7"> 7</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-8"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-8"> 8</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-9"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-9"> 9</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-10"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-10">10</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>grpcurl --plaintext  -protoset StorageApiService.protoset  localhost:8099 codeflavor.grpcrest.proto.v1.StorageApiService.GetBuckets
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;buckets&#34;</span>: <span style="color:#ff79c6">[</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;name&#34;</span>: <span style="color:#f1fa8c">&#34;bucket1&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;name&#34;</span>: <span style="color:#f1fa8c">&#34;bucket2&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">]</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>STDOUT of the gRPC server (alternatively this shows up in your container logs). Lines 12 is the exact request
that that server received.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="0"><a style="outline:none;text-decoration:none;color:inherit" href="#0"> 0</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="1"><a style="outline:none;text-decoration:none;color:inherit" href="#1"> 1</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="2"><a style="outline:none;text-decoration:none;color:inherit" href="#2"> 2</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="3"><a style="outline:none;text-decoration:none;color:inherit" href="#3"> 3</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="4"><a style="outline:none;text-decoration:none;color:inherit" href="#4"> 4</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="5"><a style="outline:none;text-decoration:none;color:inherit" href="#5"> 5</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="6"><a style="outline:none;text-decoration:none;color:inherit" href="#6"> 6</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="7"><a style="outline:none;text-decoration:none;color:inherit" href="#7"> 7</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="8"><a style="outline:none;text-decoration:none;color:inherit" href="#8"> 8</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="9"><a style="outline:none;text-decoration:none;color:inherit" href="#9"> 9</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="10"><a style="outline:none;text-decoration:none;color:inherit" href="#10">10</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="11"><a style="outline:none;text-decoration:none;color:inherit" href="#11">11</a>
</span><span style="background-color:#3d3f4a"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="12"><a style="outline:none;text-decoration:none;color:inherit" href="#12">12</a>
</span></span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="13"><a style="outline:none;text-decoration:none;color:inherit" href="#13">13</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="14"><a style="outline:none;text-decoration:none;color:inherit" href="#14">14</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="15"><a style="outline:none;text-decoration:none;color:inherit" href="#15">15</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="16"><a style="outline:none;text-decoration:none;color:inherit" href="#16">16</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="17"><a style="outline:none;text-decoration:none;color:inherit" href="#17">17</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="18"><a style="outline:none;text-decoration:none;color:inherit" href="#18">18</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>2020/12/13 16:39:22 http2: Framer 0xc0003341c0: <span style="color:#8be9fd;font-style:italic">read</span> HEADERS <span style="color:#8be9fd;font-style:italic">flags</span><span style="color:#ff79c6">=</span>END_HEADERS <span style="color:#8be9fd;font-style:italic">stream</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span> <span style="color:#8be9fd;font-style:italic">len</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">93</span>
</span></span><span style="display:flex;"><span>2020/12/13 16:39:22 http2: decoded hpack field header field <span style="color:#f1fa8c">&#34;:method&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;POST&#34;</span>
</span></span><span style="display:flex;"><span>2020/12/13 16:39:22 http2: decoded hpack field header field <span style="color:#f1fa8c">&#34;:scheme&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;http&#34;</span>
</span></span><span style="display:flex;"><span>2020/12/13 16:39:22 http2: decoded hpack field header field <span style="color:#f1fa8c">&#34;:path&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;/codeflavor.grpcrest.proto.v1.StorageApiService/GetBuckets&#34;</span>
</span></span><span style="display:flex;"><span>2020/12/13 16:39:22 http2: decoded hpack field header field <span style="color:#f1fa8c">&#34;:authority&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;localhost:8099&#34;</span>
</span></span><span style="display:flex;"><span>2020/12/13 16:39:22 http2: decoded hpack field header field <span style="color:#f1fa8c">&#34;content-type&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;application/grpc&#34;</span>
</span></span><span style="display:flex;"><span>2020/12/13 16:39:22 http2: decoded hpack field header field <span style="color:#f1fa8c">&#34;user-agent&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;grpc-go/1.30.0&#34;</span>
</span></span><span style="display:flex;"><span>2020/12/13 16:39:22 http2: decoded hpack field header field <span style="color:#f1fa8c">&#34;te&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;trailers&#34;</span>
</span></span><span style="display:flex;"><span>2020/12/13 16:39:22 http2: Framer 0xc0003341c0: <span style="color:#8be9fd;font-style:italic">read</span> DATA <span style="color:#8be9fd;font-style:italic">flags</span><span style="color:#ff79c6">=</span>END_STREAM <span style="color:#8be9fd;font-style:italic">stream</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span> <span style="color:#8be9fd;font-style:italic">len</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">5</span> <span style="color:#8be9fd;font-style:italic">data</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;\x00\x00\x00\x00\x00&#34;</span>
</span></span><span style="display:flex;"><span>2020/12/13 16:39:22 http2: Framer 0xc0003341c0: wrote WINDOW_UPDATE <span style="color:#8be9fd;font-style:italic">len</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">4</span> <span style="color:#ff79c6">(</span>conn<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">incr</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">5</span>
</span></span><span style="display:flex;"><span>2020/12/13 16:39:22 http2: Framer 0xc0003341c0: wrote PING <span style="color:#8be9fd;font-style:italic">len</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">8</span> <span style="color:#8be9fd;font-style:italic">ping</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;\x02\x04\x10\x10\t\x0e\a\a&#34;</span>
</span></span><span style="display:flex;"><span>2020/12/13 16:39:22 http2: Framer 0xc0003341c0: <span style="color:#8be9fd;font-style:italic">read</span> PING <span style="color:#8be9fd;font-style:italic">flags</span><span style="color:#ff79c6">=</span>ACK <span style="color:#8be9fd;font-style:italic">len</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">8</span> <span style="color:#8be9fd;font-style:italic">ping</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;\x02\x04\x10\x10\t\x0e\a\a&#34;</span>
</span></span><span style="display:flex; background-color:#3d3f4a"><span>&amp;v1.GetBucketsRequest<span style="color:#ff79c6">{</span>state:impl.MessageState<span style="color:#ff79c6">{</span>NoUnkeyedLiterals:pragma.NoUnkeyedLiterals<span style="color:#ff79c6">{}</span>, DoNotCompare:pragma.DoNotCompare<span style="color:#ff79c6">{}</span>, DoNotCopy:pragma.DoNotCopy<span style="color:#ff79c6">{}</span>, atomicMessageInfo:<span style="color:#ff79c6">(</span>*impl.MessageInfo<span style="color:#ff79c6">)(</span>0xc0002b0138<span style="color:#ff79c6">)}</span>, sizeCache:0, unknownFields:<span style="color:#ff79c6">[]</span>uint8<span style="color:#ff79c6">(</span>nil<span style="color:#ff79c6">)</span>, Name:<span style="color:#f1fa8c">&#34;&#34;</span><span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>2020/12/13 16:39:22 http2: Framer 0xc0003341c0: wrote HEADERS <span style="color:#8be9fd;font-style:italic">flags</span><span style="color:#ff79c6">=</span>END_HEADERS <span style="color:#8be9fd;font-style:italic">stream</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span> <span style="color:#8be9fd;font-style:italic">len</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">14</span>
</span></span><span style="display:flex;"><span>2020/12/13 16:39:22 http2: Framer 0xc0003341c0: wrote DATA <span style="color:#8be9fd;font-style:italic">stream</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span> <span style="color:#8be9fd;font-style:italic">len</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">27</span> <span style="color:#8be9fd;font-style:italic">data</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;\x00\x00\x00\x00\x16\n\t\n\abucket1\n\t\n\abucket2&#34;</span>
</span></span><span style="display:flex;"><span>2020/12/13 16:39:22 http2: Framer 0xc0003341c0: wrote HEADERS <span style="color:#8be9fd;font-style:italic">flags</span><span style="color:#ff79c6">=</span>END_STREAM|END_HEADERS <span style="color:#8be9fd;font-style:italic">stream</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span> <span style="color:#8be9fd;font-style:italic">len</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">24</span>
</span></span><span style="display:flex;"><span>2020/12/13 16:39:22 http2: Framer 0xc0003341c0: <span style="color:#8be9fd;font-style:italic">read</span> WINDOW_UPDATE <span style="color:#8be9fd;font-style:italic">len</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">4</span> <span style="color:#ff79c6">(</span>conn<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">incr</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">27</span>
</span></span><span style="display:flex;"><span>2020/12/13 16:39:22 http2: Framer 0xc0003341c0: <span style="color:#8be9fd;font-style:italic">read</span> PING <span style="color:#8be9fd;font-style:italic">len</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">8</span> <span style="color:#8be9fd;font-style:italic">ping</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;\x02\x04\x10\x10\t\x0e\a\a&#34;</span>
</span></span><span style="display:flex;"><span>2020/12/13 16:39:22 http2: Framer 0xc0003341c0: wrote PING <span style="color:#8be9fd;font-style:italic">flags</span><span style="color:#ff79c6">=</span>ACK <span style="color:#8be9fd;font-style:italic">len</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">8</span> <span style="color:#8be9fd;font-style:italic">ping</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;\x02\x04\x10\x10\t\x0e\a\a&#34;</span></span></span></code></pre></td></tr></table>
</div>
</div>
<h3 id="grpc-access-over-k8s-nginx-ingress">gRPC access over k8s NGINX ingress<a href="#grpc-access-over-k8s-nginx-ingress" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>To expose a gRPC service from kubernetes for company wide use there a few options.</p>
<h4 id="loadbalancer-service-type">LoadBalancer service type<a href="#loadbalancer-service-type" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>If you&rsquo;re in a public cloud environment you can expose the service via the service type LoadBalancer and
you&rsquo;re pretty much done.</p>
<p>If you&rsquo;re in a private cloud and have no F5 Load balancer, you can use <a href="https://metallb.universe.tf/">metallb</a>
and do the exact same thing as above.</p>
<h4 id="nginx-k8s-ingress">NGINX k8s Ingress<a href="#nginx-k8s-ingress" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p><strong>NOTE:</strong> This example disregards more advanced ingresses and gateways such as <a href="https://istio.io/latest/">Istio</a>,
<a href="https://doc.traefik.io/traefik/user-guides/grpc/">Traekif</a> or
<a href="https://www.haproxy.com/products/haproxy-enterprise-kubernetes-ingress-controller/">HAProxy</a> and only addresses
a standard <a href="https://www.nginx.com/products/nginx-ingress-controller/">NGINX ingress controller</a>.</p>
<p>If none of these are viable options to you or you prefer that your gRPC service is exposed via a URL rather than
an IP address, then you can make the kubernetes ingress forward gRPC requests to the service by adding a simple
<a href="https://kubernetes.github.io/ingress-nginx/examples/grpc/">annotation to your ingress</a>.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="0"><a style="outline:none;text-decoration:none;color:inherit" href="#0"> 0</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="1"><a style="outline:none;text-decoration:none;color:inherit" href="#1"> 1</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="2"><a style="outline:none;text-decoration:none;color:inherit" href="#2"> 2</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="3"><a style="outline:none;text-decoration:none;color:inherit" href="#3"> 3</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="4"><a style="outline:none;text-decoration:none;color:inherit" href="#4"> 4</a>
</span><span style="background-color:#3d3f4a"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="5"><a style="outline:none;text-decoration:none;color:inherit" href="#5"> 5</a>
</span></span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="6"><a style="outline:none;text-decoration:none;color:inherit" href="#6"> 6</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="7"><a style="outline:none;text-decoration:none;color:inherit" href="#7"> 7</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="8"><a style="outline:none;text-decoration:none;color:inherit" href="#8"> 8</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="9"><a style="outline:none;text-decoration:none;color:inherit" href="#9"> 9</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="10"><a style="outline:none;text-decoration:none;color:inherit" href="#10">10</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="11"><a style="outline:none;text-decoration:none;color:inherit" href="#11">11</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="12"><a style="outline:none;text-decoration:none;color:inherit" href="#12">12</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="13"><a style="outline:none;text-decoration:none;color:inherit" href="#13">13</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="14"><a style="outline:none;text-decoration:none;color:inherit" href="#14">14</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="15"><a style="outline:none;text-decoration:none;color:inherit" href="#15">15</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="16"><a style="outline:none;text-decoration:none;color:inherit" href="#16">16</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="17"><a style="outline:none;text-decoration:none;color:inherit" href="#17">17</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="18"><a style="outline:none;text-decoration:none;color:inherit" href="#18">18</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="19"><a style="outline:none;text-decoration:none;color:inherit" href="#19">19</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#ff79c6">apiVersion</span>: networking.k8s.io/v1beta1
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">kind</span>: Ingress
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">annotations</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">kubernetes.io/ingress.class</span>: nginx
</span></span><span style="display:flex; background-color:#3d3f4a"><span>    <span style="color:#ff79c6">nginx.ingress.kubernetes.io/backend-protocol</span>: <span style="color:#f1fa8c">&#34;GRPC&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">backend-protocol</span>: grpc
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">environment</span>: production
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">project</span>: myproject
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">name</span>: myingress
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">namespace</span>: mynamespace-prod
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">rules</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ff79c6">host</span>: mygrpcservice.k8s.example.com
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">http</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">paths</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ff79c6">backend</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#ff79c6">serviceName</span>: grpcservice
</span></span><span style="display:flex;"><span>          <span style="color:#ff79c6">servicePort</span>: grpcport</span></span></code></pre></td></tr></table>
</div>
</div>
<p>The catch here is that this ingress should have <code>https</code>. If you do automatic https at the nginx controller level or
you have a <code>TLS</code> section in the ingress definition above, that is up to you. <strong>gRPC over http doesn&rsquo;t work</strong>.
Another thing to keep in mind is that your nginx ingress controller needs to be <code>v0.30</code> or above.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="0"><a style="outline:none;text-decoration:none;color:inherit" href="#0"> 0</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="1"><a style="outline:none;text-decoration:none;color:inherit" href="#1"> 1</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="2"><a style="outline:none;text-decoration:none;color:inherit" href="#2"> 2</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="3"><a style="outline:none;text-decoration:none;color:inherit" href="#3"> 3</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="4"><a style="outline:none;text-decoration:none;color:inherit" href="#4"> 4</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="5"><a style="outline:none;text-decoration:none;color:inherit" href="#5"> 5</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="6"><a style="outline:none;text-decoration:none;color:inherit" href="#6"> 6</a>
</span><span style="background-color:#3d3f4a"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="7"><a style="outline:none;text-decoration:none;color:inherit" href="#7"> 7</a>
</span></span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="8"><a style="outline:none;text-decoration:none;color:inherit" href="#8"> 8</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="9"><a style="outline:none;text-decoration:none;color:inherit" href="#9"> 9</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="10"><a style="outline:none;text-decoration:none;color:inherit" href="#10">10</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="11"><a style="outline:none;text-decoration:none;color:inherit" href="#11">11</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="12"><a style="outline:none;text-decoration:none;color:inherit" href="#12">12</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="13"><a style="outline:none;text-decoration:none;color:inherit" href="#13">13</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="14"><a style="outline:none;text-decoration:none;color:inherit" href="#14">14</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="15"><a style="outline:none;text-decoration:none;color:inherit" href="#15">15</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="16"><a style="outline:none;text-decoration:none;color:inherit" href="#16">16</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="17"><a style="outline:none;text-decoration:none;color:inherit" href="#17">17</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="18"><a style="outline:none;text-decoration:none;color:inherit" href="#18">18</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="19"><a style="outline:none;text-decoration:none;color:inherit" href="#19">19</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="20"><a style="outline:none;text-decoration:none;color:inherit" href="#20">20</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="21"><a style="outline:none;text-decoration:none;color:inherit" href="#21">21</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="22"><a style="outline:none;text-decoration:none;color:inherit" href="#22">22</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="23"><a style="outline:none;text-decoration:none;color:inherit" href="#23">23</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff79c6">import</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;google.golang.org/grpc&#34;</span>
</span></span><span style="display:flex;"><span>    grpcCreds <span style="color:#f1fa8c">&#34;google.golang.org/grpc/credentials&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// this is the (https) address exposed by the kubernetes ingress.
</span></span></span><span style="display:flex; background-color:#3d3f4a"><span><span style="color:#6272a4"></span>    apiAddress <span style="color:#ff79c6">:=</span> <span style="color:#f1fa8c">&#34;mygrpcservice.k8s.example.com:443&#34;</span>
</span></span><span style="display:flex;"><span>    config <span style="color:#ff79c6">:=</span> <span style="color:#ff79c6">&amp;</span>tls.Config{
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// This is here only to make it work with self signed certs.
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>        InsecureSkipVerify: <span style="color:#ff79c6">true</span>,
</span></span><span style="display:flex;"><span>        NextProtos:         []<span style="color:#8be9fd">string</span>{<span style="color:#f1fa8c">&#34;h2&#34;</span>},
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    creds <span style="color:#ff79c6">:=</span> grpcCreds.<span style="color:#50fa7b">NewTLS</span>(config)
</span></span><span style="display:flex;"><span>    conn, err <span style="color:#ff79c6">:=</span> grpc.<span style="color:#50fa7b">Dial</span>(
</span></span><span style="display:flex;"><span>            apiAddress,
</span></span><span style="display:flex;"><span>            grpc.<span style="color:#50fa7b">WithTransportCredentials</span>(creds),
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">panic</span>(err)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">defer</span> conn.<span style="color:#50fa7b">Close</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">//conn can now be used to dial to the gRPC server.
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>}</span></span></code></pre></td></tr></table>
</div>
</div>
<p>In conclusion, i think that these things would help anyone in their quest of building resilient and
intuitive APIs but also help developers to understand better how to explore, debug and troubleshoot
gRPC APIs.</p>
<p>In the next posts i will also discuss <a href="https://github.com/grpc/grpc-web">grpc-web</a> for enabling a frontend
app to talk to a gRPC server, <a href="https://github.com/grpc-ecosystem/grpc-gateway">grpc-gateway</a> for
transcoding REST API calls to gRPC calls and also documenting, through proto annotations, the REST API
endpoints with the <a href="https://swagger.io/specification/v2/">OpenAPIv2 spec</a> and
<a href="https://github.com/grpc-ecosystem/go-grpc-middleware">gRPC interceptors</a> as gRPC middleware.</p>

      </div></div>

  

  
    

  
</article>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>Â© 2023 Powered by <a href="http://gohugo.io">Hugo</a></span>
    
      <span>:: <a href="https://github.com/panr/hugo-theme-terminal" target="_blank">Theme</a> made by <a href="https://github.com/panr" target="_blank">panr</a></span>
      </div>
  </div>
</footer>






<script type="text/javascript" src="/bundle.min.js"></script>





  
</div>

</body>
</html>
